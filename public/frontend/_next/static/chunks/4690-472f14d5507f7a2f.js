"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4690],{86910:function(e,t,r){r.d(t,{Ce:function(){return P},FC:function(){return E},K8:function(){return g},Km:function(){return Q},LD:function(){return m},VX:function(){return S},Vj:function(){return K},dA:function(){return q},dl:function(){return Z},fi:function(){return C},qv:function(){return w},rX:function(){return b},yc:function(){return h}});var n=r(72693),u=r(2265),s=r(73667),a=r(47082),i=r(20568),l=r(62696),o=r(46063),d=r(27504),c=r(6984),y=r(74767),v=r(16484),p=r(44683),_=r(95285),f=r(4249);let g=function(){let e=!(arguments.length>0)||void 0===arguments[0]||arguments[0],{user:t}=(0,c.useAuth)();return(0,s.useQuery)({queryKey:["playerFreeSpins"],queryFn:()=>(0,d.ZP)("player/freespins"),enabled:e&&!(null==t?void 0:t.isLoading)&&(null==t?void 0:t.isAuthenticated)})},b=()=>{let{toast:e}=(0,v.useToast)(),t=(0,_.J)(),r=(0,y.C)(e=>e.bootstrap.viewFiat),n=(0,a.useQueryClient)(),{track:u}=(0,f.z)();return(0,i.useMutation)({mutationFn:e=>(0,d.ZP)("player/freespins/".concat(e,"/activation"),r?{ce_currency:"USD"}:{},"POST"),onMutate:async e=>{await n.cancelQueries({queryKey:["playerFreeSpins"]});let t=n.getQueryData(["playerFreeSpins"]);return n.setQueryData(["playerFreeSpins"],t=>null==t?void 0:t.map(t=>(null==t?void 0:t.id)===e?{...t,activatable:!1,stage:"activated",cancelable:!0}:{...t})),{playerFreeSpins:t}},onSettled:r=>{u("free_spins_enabled",{category:"user",label:null==r?void 0:r.freespinsID}),e({state:"success",title:null==t?void 0:t.fs_activated}),setTimeout(()=>{n.invalidateQueries({queryKey:["playerFreeSpins"]})},1e3)},onError:(r,u,s)=>{e({state:"error",title:null==t?void 0:t.general_error}),n.setQueryData(["playerFreeSpins"],null==s?void 0:s.playerFreeSpins)}})},Q=()=>{let{toast:e}=(0,v.useToast)(),t=(0,_.J)(),r=(0,a.useQueryClient)(),{track:n}=(0,f.z)();return(0,i.useMutation)({mutationFn:e=>(0,d.ZP)("player/freespins/".concat(e),{},"DELETE").then(t=>(n("bonus_forfeited",{category:"user",label:e}),t)),onSuccess:()=>{e({state:"success",title:null==t?void 0:t.fs_canceled}),r.invalidateQueries({queryKey:["playerFreeSpins"]}),r.invalidateQueries({queryKey:["bonusesHistory"]})},onError:()=>{e({state:"error",title:null==t?void 0:t.general_error})}})},h=function(){let e=!(arguments.length>0)||void 0===arguments[0]||arguments[0],{user:t}=(0,c.useAuth)();return(0,s.useQuery)({queryKey:["playerBonuses"],queryFn:()=>(0,d.ZP)("player/bonuses"),enabled:e&&!(null==t?void 0:t.isLoading)&&(null==t?void 0:t.isAuthenticated)})},q=()=>{let{toast:e}=(0,v.useToast)(),t=(0,_.J)(),r=(0,a.useQueryClient)(),{track:n}=(0,f.z)();return(0,i.useMutation)({mutationFn:e=>(0,d.ZP)("player/bonuses/".concat(e,"/activation"),{},"POST").then(t=>(n("bonus_enabled",{category:"user",label:e}),t)),onMutate:async e=>{await r.cancelQueries({queryKey:["playerBonuses"]});let t=r.getQueryData(["playerBonuses"]);return r.setQueryData(["playerBonuses"],t=>null==t?void 0:t.map(t=>(null==t?void 0:t.id)===e?{...t,activatable:!1,stage:"activated",cancelable:!0}:{...t})),{playerBonuses:t}},onSettled:n=>{e({state:"success",title:null==t?void 0:t.bonus_activated}),setTimeout(()=>{r.invalidateQueries({queryKey:["playerBonuses"]})},1e3)},onError:(n,u,s)=>{e({state:"error",title:null==t?void 0:t.general_error}),r.setQueryData(["playerBonuses"],null==s?void 0:s.playerBonuses)}})},m=()=>{let{toast:e}=(0,v.useToast)(),t=(0,_.J)(),r=(0,a.useQueryClient)(),{track:n}=(0,f.z)();return(0,i.useMutation)({mutationFn:e=>(0,d.ZP)("player/bonuses/".concat(e),{},"DELETE").then(t=>(n("bonus_forfeited",{category:"user",label:e}),t)),onSuccess:()=>{e({state:"success",title:null==t?void 0:t.bonus_canceled}),r.invalidateQueries({queryKey:["playerBonuses"]}),r.invalidateQueries({queryKey:["bonusesHistory"]})},onError:()=>{e({state:"error",title:null==t?void 0:t.general_error})}})},K=()=>{let{toast:e}=(0,v.useToast)(),t=(0,_.J)(),r=(0,a.useQueryClient)();return(0,i.useMutation)({mutationFn:e=>(0,d.ZP)("bonuses/coupon",{coupon_code:e},"POST"),onSuccess:n=>{(null==n?void 0:n.status)&&"successfully_activated"===n.status?(e({state:"success",title:null==t?void 0:t.bonus_activated}),r.invalidateQueries({queryKey:["playerBonuses"]}),r.invalidateQueries({queryKey:["playerFreeSpins"]})):(null==n?void 0:n.status)&&"failed_to_activate"===n.status&&e({state:"error",title:null==t?void 0:t.bonus_not_activated})},onError:r=>{e({state:"error",title:(null==t?void 0:t.general_error)||r.message})}})},P=e=>{let{data:t,isPending:r}=h(),{data:n,isPending:s}=g();return{bonuses:(0,u.useMemo)(()=>t&&n?[...n.filter(t=>0===e.length||e.includes(t.stage)),...t.filter(t=>0===e.length||e.includes(t.stage))]:[],[t,n,e]),isLoading:r||s}},F=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],{offset:r,limit:u}=e;try{let e=t&&t.sort((e,t)=>(0,n.Z)(e.created_at).isAfter((0,n.Z)(t.created_at))?-1:(0,n.Z)(e.created_at).isBefore((0,n.Z)(t.created_at))?1:0);return{bonuses:u?e.slice(r,r+u):e,totalCount:e&&e.length}}catch(e){throw e}},T=(e,t)=>{var r,u;return null==e?void 0:null===(u=e.filter(e=>{var r,n;return(null==e?void 0:e.group_key)==="cashback_live_dep"||(null==e?void 0:e.group_key)==="cashback_vip_dep"||null==t||!t.stages||!((null==t?void 0:null===(r=t.stages)||void 0===r?void 0:r.length)>0)||(null==t?void 0:null===(n=t.stages)||void 0===n?void 0:n.includes(null==e?void 0:e.stage))}))||void 0===u?void 0:null===(r=u.filter(e=>{if(null==t||!t.dateInterval)return!0;{var r,u;let s=(0,n.Z)(null==t?void 0:null===(r=t.dateInterval)||void 0===r?void 0:r.split(" - ")[0]),a=(0,n.Z)(null==t?void 0:null===(u=t.dateInterval)||void 0===u?void 0:u.split(" - ")[1]);return!s||!a||(0,n.Z)(null==e?void 0:e.created_at).isAfter(s)&&(0,n.Z)(null==e?void 0:e.created_at).isBefore(a)}}))||void 0===r?void 0:r.map(e=>({...e,type:(null==e?void 0:e.amount_wager_requirement_cents)&&(null==e?void 0:e.amount_wager_requirement_cents)!==void 0||(null==e?void 0:e.amount_cents)&&(null==e?void 0:e.amount_cents)!==void 0?"deposit":"freespins"}))},S=function(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1],{bonuses:r,isLoading:n}=P(["lost","canceled","expired","wager_done"]),{data:u,hasNextPage:s,isFetchingNextPage:a,isPending:i,isFetching:d,fetchNextPage:c}=(0,l.useInfiniteQuery)({initialPageParam:e,getNextPageParam:(t,n,u)=>{let s=T(r,e);if(!((null==u?void 0:u.offset)+7>=s.length))return{...e,offset:(null==u?void 0:u.offset)+7}},queryKey:["bonusesHistory",e,r],staleTime:0,placeholderData:o.Wk,queryFn:async t=>{let{queryKey:n,pageParam:u}=t,s=T(r,e),a=await F(u,s);if(0!==a.bonuses.length)return null==a?void 0:a.bonuses},enabled:t,refetchOnMount:!0});return{data:{bonuses:u,totalCount:0},hasNextPage:s,isFetchingNextPage:a,fetchNextPage:c,isLoading:i||n,isFetching:d}},Z=e=>{var t;let{user:r}=(0,c.useAuth)();return(0,s.useQuery)({queryKey:["depositPreviewBonuses",e,null==r?void 0:null===(t=r.currentUser)||void 0===t?void 0:t.deposit_bonus_code],queryFn:()=>(0,d.ZP)("bonuses/deposit"),staleTime:0,...e,retry:!1})},E=()=>{let{t:e}=(0,p.useTranslation)(),t=(0,_.J)(),{toast:r}=(0,v.useToast)(),n=(0,a.useQueryClient)();return(0,i.useMutation)({mutationFn:e=>{try{return(0,d.ZP)("player/set_bonus_code",{deposit_bonus_code:e},"PATCH")}catch(e){throw e}},onMutate:async e=>{await n.cancelQueries({queryKey:["currentUser"]});let t=n.getQueryData(["currentUser"]);return n.setQueryData(["currentUser"],t=>({...t,deposit_bonus_code:e})),{prevCurrentUser:t}},onError:(e,u,s)=>{n.setQueryData(["currentUser"],s.prevCurrentUser),r({state:"error",title:null==t?void 0:t.general_error})},onSuccess:()=>{n.invalidateQueries({queryKey:["currentUser"]}),n.invalidateQueries({queryKey:["player"]}),n.invalidateQueries({queryKey:["depositPreviewBonuses"]})}})},w=()=>{let{t:e}=(0,p.useTranslation)(),t=(0,_.J)(),{toast:r}=(0,v.useToast)(),n=(0,a.useQueryClient)();return(0,i.useMutation)({mutationFn:()=>{try{return(0,d.ZP)("player/clear_bonus_code",{},"DELETE")}catch(e){throw e}},onSuccess:()=>{n.invalidateQueries({queryKey:["depositPreviewBonuses"]}),n.invalidateQueries({queryKey:["player"]}),n.invalidateQueries({queryKey:["currentUser"]})},onError:()=>{r({state:"error",title:null==t?void 0:t.general_error})}})},C=()=>{let{t:e}=(0,p.useTranslation)(),t=(0,_.J)(),{toast:r}=(0,v.useToast)(),n=(0,a.useQueryClient)();return(0,i.useMutation)({mutationFn:e=>{try{return(0,d.ZP)("player/update_bonus_settings",{can_issue:e},"PATCH")}catch(e){throw e}},onSuccess:()=>{n.invalidateQueries({queryKey:["depositPreviewBonuses"]}),n.invalidateQueries({queryKey:["currentUser"]}),n.invalidateQueries({queryKey:["player"]})},onError:()=>{r({state:"error",title:null==t?void 0:t.general_error})}})}},72693:function(e,t,r){var n=r(89539),u=r.n(n),s=r(65058),a=r.n(s),i=r(42366),l=r.n(i),o=r(77323),d=r.n(o),c=r(65939),y=r.n(c),v=r(49586),p=r.n(v),_=r(77618),f=r.n(_);u().extend(a()),u().extend(l()),u().extend(d()),u().extend(y()),u().extend(p()),u().extend(f()),t.Z=u()}}]);